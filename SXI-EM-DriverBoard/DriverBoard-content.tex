\usepackage{ucs}
\usepackage[utf8x]{inputenc}
\usepackage[english]{babel}
\usepackage{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage[hmargin=2cm,vmargin=2.5cm]{geometry}
\usepackage{tikz-timing}

% Space out paragraphs, don't indent
\setlength{\parindent}{0.0in}
\setlength{\parskip}{0.1in}

% Macro for including tsv generated tables
\newcommand{\tsvtable}[1]{
\begin{table}[h]
\centering
\includegraphics[height=\textheight]{#1.tsv.pdf}
\caption{#1}
\label{#1}
\end{table}
}

% Flush graphics before every new section
\usepackage{placeins}
\let\oldsection\section
\renewcommand{\section}{\FloatBarrier\oldsection} 
%\let\oldsubsection\subsection
%\renewcommand{\subsection}{\FloatBarrier\oldsubsection} 
%\let\oldsubsubsection\subsubsection
%\renewcommand{\subsubsection}{\FloatBarrier\oldsubsubsection} 

% Put the page numbers in the top right corner
\pagestyle{headings}

\usepackage[pdftex]{hyperref}

\author{John P. Doty}
\date{\today}
\title{SXI Driver Board Design}

\begin{document}
\begin{titlepage}
\maketitle
\begin{center}
\verb$Id$
\end{center}
\vspace{5cm}

This work is Copyright 2010, 2011 Noqsi Aerospace, Ltd.

This work is licensed under the Creative Commons Attribution-Share Alike 3.0 License. To view a copy of this license, visit http://creativecommons.org/licenses/by-sa/3.0/ or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.

\end{titlepage} 

\section{Introduction}
This document describes the circuits on the driver board for the Soft X-ray Imager under development for the ASTRO-H high energy astronomy mission.

This version of the design is intended for resource estimation and preliminary review. This document will evolve as the design evolves.

In the SXI focal plane, there will be four Hamamatsu CCD-PchNeXT4 sensor chips. Each chip will have its own driver board. 

The nominal horizontal clock timing has a complex rhythm, with a minimum half cycle time of 2.4\ $\mu$s, and a sustained rate of 138.888\ kHz during readout. Vertical clock half cycles will be 14.4\ $\mu$s, and the vertical clock rate during frame transfer will be 34.722\ kHz. Available regulated voltages will be +15V, -15V, and +3.3V. 

%These parameters were established after many of these circuits were first drawn, so they should be checked, particularly for adequate voltage breakdown margin.

\subsection{Requirements}
Tables \ref{Clocks} and \ref{Biases} derive primarily from the CCD-PchNeXT4 specsheet. Required voltage precision is based on previous CCD experience. The last column identifies the circuit that must meet the requirement, for reference.

\begin{table}[h]
\centering
\begin{tabular}{|l|rrrr|rrrr|r|l|}
\hline
&\multicolumn{4}{c|}{Low(V)}&\multicolumn{4}{c|}{High(V)}& C(pF)& Driver Circuit \\ 
&Min.&Typ.&Max.&Prec.&Min.&Typ.&Max&Prec.&& \\
\hline
RG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
SG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
TG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 180 & Serial-driver \\
P1VI & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 35000 & Parallel \\
P2VI & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 35000 & Parallel \\
P1VS & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 25000 & Parallel \\
P2VS & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 25000 & Parallel \\
P1H & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 230 & Serial-driver \\
P3H & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 230 & Serial-driver \\
P2/4H-1 & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 130 & Serial-driver \\
P2/4H-2 & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 130 & Serial-driver \\
P2/4H-3 & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 130 & Serial-driver \\
P2/4H-4 & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 130 & Serial-driver \\
ISV & -13 & -12 & -11 & 0.1 & -7 & -6 & -5 & 0.1 &160 & Serial-driver \\
\hline
\end{tabular}
 \caption{CCD Clocks.}
 \label{Clocks}
\end{table}

Exactly what the capacitances represent isn't clearly defined on the specsheet, although it appears likely that they are gate-gate capacitance for the two phase clocks, and gate-substrate for single ended clocks. More on this in section \ref{ClockDrivers}.


\begin{table}[h]
\centering
\begin{tabular}{|l|rrrr|r|l|}
\hline
&\multicolumn{4}{c|}{Bias(V)} &mA&Driver Circuit \\
&Min.& Typ.& Max.&Prec& Max.&\\
\hline
OD-A &-22 &-20& -18& 0.1&1.2&DC-driver \\
OD-B &-22 &-20& -18& 0.1&1.2&DC-driver \\
OD-C &-22 &-20& -18& 0.1&1.2&DC-driver \\
OD-D &-22 &-20& -18& 0.1&1.2&DC-driver \\
RD &-13& -12 &-11& 0.1&0.001&DC-driver \\
OG& -7& -5& -3&  0.1&0.001&DC-driver \\
BB &0 &+30 &+40 &0.5&0.001&BB \\
IG1V&-7.0&-6.0&+3.0&0.04&0.001&DC-driver \\
IG2V&-7.0&-6.0&+3.0&0.04&0.001&DC-driver \\
\hline
\end{tabular}
 \caption{Biases.}
 \label{Biases}
\end{table}



\section{Building Block Details}
\subsection{Infrastructure}
\subsubsection{REF}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{REF.pdf}
   \end{center}
   \caption{REF Block}
   \end{figure}

The REF block provides a 2.5V reference voltage for the DAC and driver circuits. The REF43 has flown successfully on a number of missions, including Suzaku. 2.5V seems a good choice for a reference in a system whose low voltage supply is 3.3V. This device also measures the Driver Board tmperature. 

The capacitors implement the recommended bypassing for the REF43.
R1 provides current limiting and decoupling. U2 buffers and amplifies the temperature measurement output for housekeeping.


\subsubsection{DAC}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DAC.pdf}
   \end{center}
   \caption{DAC Block}
   \end{figure}
This block provides a buffered output from 0V to (255/256) of the reference voltage. R1 provides decoupling and current limiting in case of latchup.

\subsection{Bias Drivers}
\subsubsection{BB}

The BB (Back Bias) block consists of a Cockroft-Walton charge pump voltage multiplier and a regulator. It provides the high voltage needed to deplete the main volume of the CCD and drive charge from the backside to the channel.

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{BB.pdf}
   \end{center}
   \caption{BB Block}
   \end{figure}

U2 switches between $Vp$ (+15V) and ground creating 15V square-wave drive for a charge pump. D1, D2, D3, and their associated capacitors form a three stage charge pump, in series with $Vp$, nominally capable of 60V output if losses are ignored. 

Q1 and Q2 are high voltage transistors making a voltage translation amplifier with gain of about 4.5 (set by $R11/R10$)and an offset roughly equal to the pump output voltage. Applying a negative voltage to R10 thus reduces the output voltage (BB). Half of U1 provides this negative drive. R9 and R10 set the gain at 16, so the maximum output voltage is 40V. The output time constant is $R12\times C10$, or about 1 ms. In this case, the damping effect of C11 is reduced by the gain of the voltage translation stage, so for critical damping the $R9\times C11$ time constant should be $(4.5\times4)$ or 18ms. As drawn, the circuit is slightly underdamped. R10 is small enough that U1 can pull the emitter of Q2 below ground, thus turning Q1 completely off, allowing the output to go down to ground.

43V precision Zener diode D3 limits the output voltage to below the absolute maximum of 45V without preventing an output of the maximum operating voltage of 40V.

The load current on BB is $<1\ \mu$A The voltage regulator and housekeeping circuit pull $100\ \mu$A from the pump.

R2 and R3 limit current to U2, protecting it in case of latchup. R4 and R14 limitg current to U1, although that's less of a concern: U1 is not CMOS so it should be more resistant to latchup. These resistors also help decouple chip power from power supply noise and ripple. R1 limits surge current through U2.

Output filter capacitors have separate return connections here so that they may be connected for best EMI performance at the higher level.




\subsubsection{DC-driver}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DC-driver.pdf}
   \end{center}
   \caption{DC-driver Block}
   \end{figure}

This provides negative DC drive for the various bias lines. It also provides regulated clock levels for the ISV clock. These lines are potentially a path for noise to reach the CCD video output. The filter formed by R2 and C2 is intended to attenuate noise at the video frequency. RETA should go to the sensor analog ground point, which should have a low impedance to system ground.
However, this filter potentially destabilizes the driver circuit: C1 provides phase-advanced feedback to stabilize the circuit. If the feedback time constant $R1\times C1$ is four times the output time constant $R2\times C2$, the circuit is critically damped, assuming that this time constant is also large compared to the amplifier's unity gain small signal response time, which it is in this case $(120\mu s>>1 \mu s)$. When critically damped, the circuit has two poles with time constant $2\times R2\times C2$.

The LT1078 opamp used can drive $>5$mA, so it has plenty of margin in this circuit: the maximum load for this circuit is 1.2mA when driving one of the output drains. 

The input is a current into a virtual ground, allowing resistors to set scale and offset individually for each of these circuits.

V+ should normally be 3.3V to prevent positive drive from pulling the opamp input above the positive rail. V- can be -15V if adequate, or the -30V from the OD-pump block if needed.



\subsubsection{OD-pump}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{OD-pump.pdf}
   \end{center}
   \caption{OD-pump Block}
   \end{figure}
   
This charge pump provides -30V (nominal assuming no losses). It is a single stage design, pumping negative charge from a 15V square wave signal using the -15V supply as its "ground". It is intended to be able to drive at least 10 mA. Q3, Q4, and their associated resistors form a current limiter to protect against an output short circuit. R4 and R5 protect U1 against latchup.



\pagebreak
\subsection{CCD Clock Drivers}
\label{ClockDrivers}
Figure \ref{ClockCap} shows a model of the two phase CCD clock capacitances. The data sheet capacitance is Cgg.  Because of the symmetry of the two phase drive, the effective driver load capacitance, $Cdl=2Cgg$, twice that given on the data sheet.

Maximum clock swing $\Delta V$ is 12V for all clocks. The dynamic current the power supply needs to provide is $f\times C \times \Delta V$. For the fast (horizontal) clocks $f$ is 136 kHz, so this is about 1.7\ mA/nF. For the slow (vertical) clocks $f$ is 32 kHz, so this is about 0.4\ mA/nF.

Maximum clock swing $\Delta V$ is 12V for all clocks. The dynamic current the power supply needs to provide is $f\times C \times \Delta V$. For the fast (horizontal) clocks $f$ is 136 kHz, so this is about 1.7\ mA/nF. For the slow (vertical) clocks $f$ is 32 kHz, so this is about 0.4\ mA/nF.

   \begin{figure}[h]
   \begin{center}
   \includegraphics[width=\textwidth,angle=0,keepaspectratio=true]{ClockCap.pdf}
   \caption{Two phase drive allows simplification of the model of clock capacitance.}
   \label{ClockCap}
   \end{center}
   \end{figure}

\subsubsection{DACtoClock}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DACtoClock.pdf}
   \end{center}
   \caption{DACtoClock Block}
   \end{figure}


This is a pair of amplifiers yielding adjustable outputs of 0 to 7.5V and -10V to -2.5V for drivers. Noise filtering and damping are similar to the DC-driver block above, but with larger capacitance to handle the time-varying load current. These can directly provide the regulated drive for the fast clock drivers: with output current capability $\approx 10$\ mA, they can handle the current demands of a $\approx 6$\ nF load. For the slow (vertical), drivers, these handle level translation but do not provide the large regulated current required.

\subsubsection{ParallelReg}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{ParallelReg.pdf}
   \end{center}
   \caption{ParallelReg Block}
   \end{figure}

These are overload-protected high current regulators intended for clocking of a high capacitance CCD. One design challenge here is that the duty cycle is low. To avoid excessive power drain, the idle current must be minimized. Another challenge is providing the required peak current without danger of overheating. An upset or programming error can  potentially raise the duty cycle to the point where power dissipation could cause damage.

The NPN "transistors" in this block are LM195 "Ultra Reliable Power Transistor" integrated circuits. These devices protect themselves against excessive current and temperature. Q1 and Q5 provide the large output current surges safely.

Additional LM195 devices, Q3 and Q6, limit supply current and provide some decoupling. In this connection, they act like $\approx 1\Omega$ resistors below their $>1$A current limits. Short circuit failures of C1 or C4 can not disable the whole SXI, only one chip.

The (C1, R3) and (C3, R6) combinations reduce the high frequency output impedance, reducing transient voltage excursions. They also stabilize the closed loop regulation. The closed loop gain is unity.

These regulators can deliver $>1$A peak (corresponding to a 2500\ nF load) and $>30$ mA average current. Idle current is  $\approx 2$ mA from the +15V supply and $\approx 3$ mA from the -15V supply for the regulator pair.

\subsubsection{ParallelPair}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{ParallelPair.pdf}
   \end{center}
   \caption{ParallelPair Block}
   \end{figure}

This is a high current driver intended for high speed clocking of a high capacitance CCD. Connecting the drive transistors in a common source configuration insures break before make switching. The output resistors R1 and R2 insure that the source voltage follows the gate voltage closely enough to prevent gate-source breakdown, regardless of the magnitude of the capacitive load. The other resistors limit fault currents due to latchup or output short circuits and provide decoupling.

\subsubsection{SerialDrivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{SerialDrivers.pdf}
   \end{center}
   \caption{SerialDrivers Block}
   \end{figure}
   
This is just a pair of analog switches, intended to drive a moderate capacitance clock. The resistors limit fault currents due to latchup or output short circuits and provide decoupling.

\subsection{Temperature Control}

\subsubsection{Temperature Measurement}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{Temperature.pdf}
   \end{center}
   \caption{Temperature Block}
   \end{figure}
   
This 12 bit ADC is connected as a ratiometric ohmmeter. U1 is connected as a constant current source with reference voltage equal to the 5V reference power provided to the ADC, and reference resistance R1 ($1180\ \Omega$). This current develops a voltage across the sensor. The topology makes the measurement insensitive to resistance between I+ and V+, but the sensor return resistance to ground must be low, as it can affect the measurement. Because the circuit uses the same reference voltage for the ADC and the current source, it measures the ratio of the sensor resistance to R1. $1180\ \Omega$ for a Pt1000 sensor corresponds to a temperature of 46\ C, so this is the full scale temperature.

VD on the ADC must remain below VA when power is turned on. Q1 insures that this condition will be met.

\subsubsection{Heater Control}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{TempControl.pdf}
   \end{center}
   \caption{TempControl Block}
   \end{figure}

The first section of U1 buffers 1/10 the heater supply voltage (Vhtr) as a reference for DAC U2. The second section of U1 together with Q1 is a differential amplifier with a gain of 10, controlling the voltage at Ihtr.  If the heater is connected between Vhtr and Ihtr, the heater voltage will be proportional to the DAC setting, with full scale equal to Vhtr. In practice, it won't quite reach that value because of saturation of Q1.

Q1 is an LM195, which will protect itself against overheating. It also has limited transconductance, $\approx\ 1$\ S, which helps stability. C1 provides stabilizing feedback, much more than required for any reasonable heater resistance.

\subsection{Housekeeping}

\subsubsection{Housekeeping ADC}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{hkadc.pdf}
   \end{center}
   \caption{Housekeeping ADC Block}
   \end{figure}

This is a 12 bit ADC with a high Z input whose range is -12.76V to 12.89V. U1 handles buffering, attenuation, and bias, allowing the 5V unipolar ADC chip to cover the wider bipolar range required. Q1 insures proper power sequencing, as in the Temperature Measurement block.

\section{Connecting the Blocks}

The top level schematics indicate interconnections between pages with bus symbols.

\begin{tabular}{ll}
Power & Board internal power \\
DAC & DAC output and reference voltages \\
Control & Digital controls and clocks \\
Output & CCD Driver outputs \\
HK & Housekeeping test points \\
\end{tabular}

These graphical indicators do not necessarily imply the existence of physical busses on the board.

\subsection{Reference and DACs}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.1.pdf}
   \end{center}
   \caption{Reference and DACs}
   \end{figure}
   
This provides the 2.5V reference voltage and 24 DAC channels for control of CCD clock and bias levels.
  


\subsection{RG and SG Drivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.2.pdf}
   \end{center}
   \caption{RG and SG Drivers}
   \end{figure}

This drives the reset gate and summing gate. These gates have low capacitance, so drive requirements are not challenging. For best clock level stability, these should be driven perfectly periodically, even during vertical transfers. There is no harm in doing so, and this will reduce variation of the video bias across the CCD image.
  


\subsection{TG and ISV Driver}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.3.pdf}
   \end{center}
   \caption{TG Driver}
   \end{figure}
   
The TG driver drives the transfer gate between the vertical and horizontal register of the CCD. The ISV driver drives the charge injection electrode. These are low capacitance loads.
  


\subsection{Horizontal Register Driver}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.4.pdf}
   \end{center}
   \caption{Horizontal Register Driver}
   \end{figure}
   
The data sheet capacitances for these clocks total 1380\ pF. Applying the factor of 2 above for the effective capacitance, the total effective capacitance is $\approx 2.8$\ nF. A single DACtoClock block (drive capability $\approx 6$\ nF) suffices to provide the regulated drive voltages.
  


\subsection{VI Driver}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.5.pdf}
   \end{center}
   \caption{VI Driver}
   \end{figure}

The total effective capacitance of the to vertical imaging clocks is $\approx 140$\ nF, well within the 2500\ nF capacity of the ParallelReg block supplying the regulated drive voltage.


\subsection{VS Driver}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.6.pdf}
   \end{center}
   \caption{VS Driver}
   \end{figure}

The vertical storage area has lower capacitance that the vertical imaging area, so a similar drive circuit suffices.


\subsection{Output Drain Drivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.7.pdf}
   \end{center}
   \caption{Output Drain Drivers}
   \end{figure}

These provide -17 to -23\ V for the output drains. Maximum load per drain is 1.2\ mA, not a challenge for a DC-driver block.  


\subsection{Bias Drivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.8.pdf}
   \end{center}
   \caption{Bias Drivers}
   \end{figure}
  
The reset drain (RD) driver provides -10 to -14\ V. 
The output gate (OG) driver provides -2 to -8\ V.
The charge injection gate 1 (IG1) driver provides -7 to +3\ V.
The charge injection gate 2 (IG2) driver provides -7 to +3\ V.
The back bias driver provides 0 to 40\ V.


\subsection{Power Translation}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.9.pdf}
   \end{center}
   \caption{Power Translation}
   \end{figure}
  
A small amount of power (total nominally $<1$\ mA, but probably somewhat larger due to dynamic power consumption) is required at +5V by the DG403 switches. The ADC128S102 ADC's need a tightly regulated 5V supply, which serves both as analog power and voltage reference. The vertical clock drivers need a slightly reduced supply for the positive side to limit voltage stress on the transistors, so we generate +12\ V here. The input gate drivers need a negative reference voltage, so we generate -2.5\ V here. The LT1078 opamps we are using for other functions have more than enough current capability here and will be highly efficient. The +12V, +5V, and -2.5ref loads are resistively decoupled, so there will be no capacitive instability issue. The +5ADC is capacitively loaded, so it requires damping components C2 and R18.

  
The OD-pump provides $\approx -28$\ V for the output drain drivers.

\subsection{Bias and Power Housekeeping}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.10.pdf}
   \end{center}
   \caption{Bias and Power Housekeeping}
   \end{figure}

The multiplexers on this page feed bias and power supply voltages to the housekeeping ADC. Most of these are outside the $\pm 12.5$\ V range of the ADC, so 4X attenuators reduce the voltages.


\subsection{Clock Level Housekeeping}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.11.pdf}
   \end{center}
   \caption{Clock Level Housekeeping}
   \end{figure}

The multiplexers on this page feed clock levels to the housekeeping ADC. The driver board temperature monitor signal is also included here.


\subsection{Housekeeping ADC}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.12.pdf}
   \end{center}
   \caption{Housekeeping ADC}
   \end{figure}

This page just shows the board-level connections of the HKADC block.


\subsection{Video Housekeeping}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.13.pdf}
   \end{center}
   \caption{Video Housekeeping}
   \end{figure}


R47 provides a load for an AD590 temperature sensor on the video board. This circuit also monitors references and the power supply.


\subsection{Command and Housekeeping Protocols}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.14.pdf}
   \end{center}
   \caption{Command Decoding}
   \end{figure}

The Pixel Electronics send digital commands to the Driver Board, and retrieve housekeeping data, through a serial interface. Some of these flow through the Driver Board to or from the video board. The serial interface operates at the PCLK rate (1.1\ MHz), and consists of two serial data signals and two control "strobes".


\begin{tabular}{ll}
PCLK & Serial command clock \\
DVCD & Driver/video serial command data \\
HKDAT & Driver/video serial housekeeping data \\
DVMS & Driver/video mode strobe \\
$\overline{\textup{DVCS}}$ & Driver/video command strobe \\
\end{tabular}

Because the targeted subsystems have different serial protocols, command transmission proceeds in at least two stages. For commands, these are mode control and command transfer. For housekeeping, an additional data transfer stage is required.

In the mode control stage, the PE should transmit 8 bits of mode information followed by a (positive) pulse of DVMS. Rising edges of PCLK and DVMS control the mode deserialization. For reliable capture of the data bits, the rising edges of PCLK should occur when DVCD is stable. The rising edge of DVMS should occur after capture of the final data bit, but before the next rising edge of PCLK. $\overline{\textup{DVCS}}$ should remain high during mode selection. The following timing diagram obeys these rules robustly:

{\large
\newcounter{bitcount}
\addtocounter{bitcount}{7}
\begin{tikztimingtable}
PCLK & 20{C} \\
DVCD & 2U8{2D{M\arabic{bitcount}\addtocounter{bitcount}{-1}}}2U \\
DVMS & 18L2{C} \\
$\overline{\textup{DVCS}}$ & 20H \\
\end{tikztimingtable}}

Setting the mode in this fashion controls the routing of $\overline{\textup{DVCS}}$. Then, the PE transmits information to the subsystem under control of $\overline{\textup{DVCS}}$ using a the protocol appropriate to the subsystem.

The two most significant bits (M7 and M6) of the mode byte indicate the selected subsystem.

\begin{tabular}{|l|l|}
\hline
Code & Subsystem \\
\hline
00 & DAC \\
\hline
01 & Housekeeping MUX \\
\hline
10 & Housekeeping ADC \\
\hline
11 & Video Board \\
\hline
\end{tabular}

\subsubsection{DAC Mode}

In DAC mode (00), the two least signficant bits (M1 and M0) of the mode byte select the DAC chip. Once you've placed the driver board into DAC mode, $\overline{\textup{DVCS}}$ is applied to the $\overline{\textup{LD}}$ pin of the selected DAC. PCLK and DVCD are always applied to CLK and SDI of every DAC, but $\overline{\textup{LD}}$ controls whether the DAC responds to them. In the command transfer stage of this mode the timing of PCLK, DVCD, and $\overline{\textup{DVCS}}$ should correspond respectively to CLK, SDI, and $\overline{\textup{LD}}$ in the interface protocol of the DAC8800 chip. The DAC8800 transfers serial data on the rising edge of the serial clock (PCLK). A low level on $\overline{\textup{DVCS}}$ latches the captured serial data.

{\large
\newcounter{dacbit}
\addtocounter{dacbit}{7}
\newcounter{dacnum}
\addtocounter{dacnum}{2}
\begin{tikztimingtable}
PCLK & 27{C} \\
DVCD & 2U3{2D{A\arabic{dacnum}\addtocounter{dacnum}{-1}}}8{2D{D\arabic{dacbit}\addtocounter{dacbit}{-1}}}3U \\
$\overline{\textup{DVCS}}$ & 23.75H0.5L2.75H \\
DVMS & 27L \\
\end{tikztimingtable}}

Including an allowance for decoding propagation, the falling edge of  $\overline{\textup{DVCS}}$  should come at least 50\ ns after the rising edge of PCLK, the $\overline{\textup{DVCS}}$ pulse width should be at least 75\ ns, and the rising edge of $\overline{\textup{DVCS}}$ should come at least 100\ ns before the rising edge of PCLK.

Data is transmitted most significant bit first. Bits A2-A0 select the DAC within the chip, while bits D7-D0 are the data to be loaded into the DAC.
See the DAC8800 data sheet for more details. 

\subsubsection{Housekeeping MUX Mode}

In Housekeeping MUX mode, the six least significant bits of the mode byte select the housekeeping channel. In this mode, DVCD is ignored. The command transfer stage is simply a pulse of  $\overline{\textup{DVCS}}$:

{\large
\begin{tikztimingtable}
$\overline{\textup{DVCS}}$ & 2H2L2H \\
DVMS & 6L \\
\end{tikztimingtable}}

This will place the channel data in the MUX selection latches and apply the selected channel to the housekeeping ADC.

\subsubsection{Housekeeping ADC Mode}

After setting the housekeeping MUX, the controller should wait at least 625\ $\mu$s before initiating a conversion with the housekeeping ADC (the buffer amplifier for the ADC has a very low slew rate). A falling edge on $\overline{\textup{DVCS}}$ in Housekeeping ADC Mode initiates the conversion. The ADC yields 16 bits four zero bits followed by 12 data bits, most significant bit first. $\overline{\textup{DVCS}}$ should remain low for the entire 16 cycle conversion time.

{\large
\newcounter{hkbit}
\addtocounter{hkbit}{11}
\begin{tikztimingtable}
PCLK & 36{C} \\
$\overline{\textup{DVCS}}$ & 2H32L2H \\
HKDAT & 2U8L12{2D{B\arabic{hkbit}\addtocounter{hkbit}{-1}}}2U\\
DVMS & 36L \\
\end{tikztimingtable}}


See the ADC128S102 datasheet for more details.

\subsubsection{Video Board Mode}

In Video Board mode, this Driver Board routes $\overline{\textup{DVCS}}$ to $\overline{\textup{VSTROBE}}$ to control the Video Board FPGA, and routes VCRD to HKDAT to receive returned data, if any. PCLK always drives VPCLK, and DVCD always drives VCMD. The timing of the command and data transfer stages of communication with this subsystem are not yet defined: it depends on the Video Board FPGA design.


\subsection{CCD Clock Decoding}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.15.pdf}
   \end{center}
   \caption{CCD Clock Decoding}
   \end{figure}
   
The timing signals for the CCD clocks are transmitted as two 10Mb/s serial streams, clocked by the rising edge of SCLK, strobed by the rising edge of SYNC.

{\large
\newcounter{cccbit}
\addtocounter{cccbit}{7}
\begin{tikztimingtable}
SCLK & 20{C} \\
SEQA & 2U8{2D{A\arabic{cccbit}\addtocounter{cccbit}{-1}}}2U\\
\addtocounter{cccbit}{8}
SEQB & 2U8{2D{B\arabic{cccbit}\addtocounter{cccbit}{-1}}}2U\\
STROBE & 17DLHD \\
\end{tikztimingtable}}

\subsection{Digital Power/HK Multiplexer}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.16.pdf}
   \end{center}
   \caption{Digital Power}
   \end{figure}

This page shows the power connections to the Driver Board's digital chips, the power up reset circuits, and the digital multiplexing of housekeeping and Video Board data.


\subsection{LVDS Drivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.17.pdf}
   \end{center}
   \caption{LVDS Drivers}
   \end{figure}
 
The Driver Board transmits digital signals to the PE and video board via LVDS.


\subsection{LVDS Receivers}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.18.pdf}
   \end{center}
   \caption{LVDS Receivers}
   \end{figure}

The Driver Board receives digital signals from the PE and video board via LVDS.



\subsection{Video Power Filters}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.19.pdf}
   \end{center}
   \caption{Video Power Filters}
   \end{figure}

Power filters for the Video board are installed on the Driver Board.

\subsection{Slave Jumpers and Non-serialized Clocks}
   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{DriverBoard.20.pdf}
   \end{center}
   \caption{Slave Jumpers and Non-serialized Clocks}
   \end{figure}

"Zeroohm" resistors RZ1-RZ14 should be installed on "master" boards. They route the multidrop LVDS signals to the "slave" boards.

U20 is the LVDS receiver for the SG and ISV timing from the sequencer. These signals have critical timing requirements, so they are not multiplexed with the other timing signals.


\section{TCE}

   \begin{figure}
   \begin{center}
   \includegraphics[width=\textheight,angle=90,keepaspectratio=true]{TCE.pdf}
   \end{center}
   \caption{TCE}
   \end{figure}


Each driver board will have the footprints for Temperature Control Electronics, but only two of the four boards will populate these with components.

\subsection{Command and Measurement Protocols}

The Pixel Electronics send digital commands to the TCE, and retrieve housekeeping data, through a serial interface. Some of these flow through the Driver Board to or from the video board. The serial interface operates at the PCLK rate (1.1\ MHz), and consists of two serial data signals and two control "strobes".

\begin{tabular}{ll}
PCLK & Serial command clock \\
TCD & TCE serial command data \\
TCEDAT & TCE serial temperature data \\
TMS & TCE mode strobe \\
$\overline{\textup{TCS}}$ & TCE command strobe \\
\end{tabular}

Because the targeted subsystems have different serial protocols, command transmission proceeds in at least two stages. For commands, these are mode control and command transfer. For housekeeping, an additional data transfer stage is required.

In the mode control stage, the PE should transmit 8 bits of mode information followed by a (positive) pulse of TMS. Rising edges of PCLK and TMS control the mode deserialization. For reliable capture of the data bits, the rising edges of PCLK should occur when TCD is stable. The rising edge of TMS should occur after capture of the final data bit, but before the next rising edge of PCLK. $\overline{\textup{TCS}}$ should remain high during mode selection. The following timing diagram obeys these rules robustly:

{\large
\newcounter{tbitcount}
\addtocounter{tbitcount}{7}
\begin{tikztimingtable}
PCLK & 20{C} \\
TCD & 2U8{2D{M\arabic{tbitcount}\addtocounter{tbitcount}{-1}}}2U \\
TMS & 18L2{C} \\
$\overline{\textup{TCS}}$ & 20H \\
\end{tikztimingtable}}

Setting the mode in this fashion controls the routing of $\overline{\textup{TCS}}$. Then, the PE transmits information to the subsystem under control of $\overline{\textup{DVCS}}$ using a the protocol appropriate to the subsystem.

The two most significant bit (M7) of the mode byte indicates the selected subsystem.

\begin{tabular}{|l|l|}
\hline
Code & Subsystem \\
\hline
0 & Heater DAC \\
\hline
1 & Temperature ADC \\
\hline
\end{tabular}

The two least significant bits (M1, M0) of the mode byte select the temperature to be measured in Temperature ADC Mode.

\begin{tabular}{|l|l|}
\hline
Code & Sensor \\
\hline
00 & CCD A \\
\hline
01 & CCD B \\
\hline
10 & Cold Plate \\
\hline
\end{tabular}


\subsubsection{Heater DAC Mode}

Once you've placed the driver board into Heater DAC mode, $\overline{\textup{TCS}}$ is applied to the $\overline{\textup{LD}}$ pin of the selected DAC. PCLK and TCD are always applied to CLK and SDI of every DAC, but $\overline{\textup{LD}}$ controls whether the DAC responds to them. In the command transfer stage of this mode the timing of PCLK, DVCD, and $\overline{\textup{TCS}}$ should correspond respectively to CLK, SDI, and $\overline{\textup{LD}}$ in the interface protocol of the DAC8800 chip. The DAC8800 transfers serial data on the rising edge of the serial clock (PCLK). A low level on $\overline{\textup{TCS}}$ latches the captured serial data.

{\large
\newcounter{hdacbit}
\addtocounter{hdacbit}{7}
\begin{tikztimingtable}
PCLK & 27{C} \\
TCD & 2U3{2L}8{2D{D\arabic{hdacbit}\addtocounter{hdacbit}{-1}}}3U \\
$\overline{\textup{TCS}}$ & 23.75H0.5L2.75H \\
TMS & 27L \\
\end{tikztimingtable}}

Including an allowance for decoding propagation, the falling edge of  $\overline{\textup{TCS}}$  should come at least 50\ ns after the rising edge of PCLK, the $\overline{\textup{TCS}}$ pulse width should be at least 75\ ns, and the rising edge of $\overline{\textup{DVCS}}$ should come at least 100\ ns before the rising edge of PCLK.

Data is transmitted most significant bit first. The first three bits select the DAC within the chip. These must be zero, as shown in the diagram. D7-D0 are the data to be loaded into the DAC.See the DAC8800 data sheet for more details. Loading zero turns the heater off, while loading 255 sets the heatyer to maximum. 

\subsubsection{Temperature ADC Mode}

After setting the temperature selection bits in the mode byte, the controller should wait at least 125\ $\mu$s before initiating a conversion with the temperature ADC (the current control amplifier driving the sensor has a very low slew rate). A falling edge on $\overline{\textup{TCS}}$ in Temperature ADC Mode initiates the conversion. The ADC yields 16 bits four zero bits followed by 12 data bits, most significant bit first. $\overline{\textup{TCS}}$ should remain low for the entire 16 cycle conversion time.

{\large
\newcounter{tbit}
\addtocounter{tbit}{11}
\begin{tikztimingtable}
PCLK & 36{C} \\
$\overline{\textup{DVCS}}$ & 2H32L2H \\
TCEDAT & 2U8L12{2D{B\arabic{tbit}\addtocounter{tbit}{-1}}}2U\\
TMS & 36L \\
\end{tikztimingtable}}


See the ADC128S102 datasheet for more details.

\section{External interfaces}

For the current overview of the interconnection strategy see 20101125\_hayasida\_SXI-S-FE\_Box.pdf.

This section lists the connectors on the Driver Board and designates their pins.

\subsection{Power}

Table \ref{J1} shows the pinout of J1. This carrys power from the PE.

%\tsvtable{J1}
% This one is small so we don't use the template
\begin{table}[h]
\centering
\includegraphics[]{J1.tsv.pdf}
\caption{J1}
\label{J1}
\end{table}

\subsection{PE interface}

Table \ref{J2} shows the pinout of J2. This is the LVDS interface to the PE. On a "master" Driver Board, this connects directly to the PE. On a "slave" Driver board, it connects to J3 on its "master" board. Table \ref{J3} shows the pinout of that connector.

\tsvtable{J2}
\tsvtable{J3}

\subsection{Sensor Body Interface}

Table \ref{J4} shows the pinout of J4,which carries analog power, CCD drive signals, and analog houskeeping and thermometry signals from the sensor body.

\tsvtable{J4}

Table \ref{J5} slows the pinout of J5, which carries digital interfaces and power to to sensor body.

%\tsvtable{J5}
% This one is small so we don't use the template
\begin{table}[h]
\centering
\includegraphics[]{J5.tsv.pdf}
\caption{J5}
\label{J5}
\end{table}

\section{DAC and Housekeeping Tables}

Table \ref{DACV} shows the DAC-controlled voltages. DAC numbers are in base 8 (octal). Table \ref{HKC} has more detailed descriptions of the functions.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
DAC & Function & V(0) & V(255) & Resolution \\
00 & RGHI & 0.00 & 7.48 & 0.0293 \\
01 & RGLO & -2.5 & -10.03 & -0.0295 \\
02 & SGHI & 0.00 & 7.48 & 0.0293 \\
03 & SGLO & -2.5 & -10.03 & -0.0295 \\
04 & TGHI & 0.00 & 7.48 & 0.0293 \\
05 & TGLO & -2.5 & -10.03 & -0.0295 \\
06 & PHHI & 0.00 & 7.48 & 0.0293 \\
07 & PHLO & -2.5 & -10.03 & -0.0295 \\
10 & VIHI & 0.00 & 7.48 & 0.0293 \\
11 & VILO & -2.5 & -10.03 & -0.0295 \\
12 & VSHI & 0.00 & 7.48 & 0.0293 \\
13 & VSLH & -2.5 & -10.03 & -0.0295 \\
14 & IG1V & 3.03 & -6.99 & -0.0393 \\
15 & IG2V & 3.03 & -6.99 & -0.0393 \\
16 & ISVHI & 0.00 & -13.35 & 0.0523 \\
17 & ISVLO & 0.00 & -13.35 & -0.0523 \\
20 & OD-A & -17.04 & -23.01 & -0.0234 \\
21 & OD-B & -17.04 & -23.01 & -0.0234 \\
22 & OD-C & -17.04 & -23.01 & -0.0234 \\
23 & OD-D & -17.04 & -23.01 & -0.0234 \\
24 & RD & -10.06 & -14.08 & -0.0158 \\
25 & OG & -2.02 & -7.99 & -0.0234 \\
26 & BB & 0.00 & 40.86 & 0.160 \\
27 & unused & & & \\
\hline
\end{tabular}
\caption{DAC controlled voltages}
\label{DACV}
\end{table}

Table \ref{HKC} shows the housekeeping channels on the Driver Board. Channel numbers are in base 8 (octal). 

DTEMP is the output of the temperature monitor circuit in the REF43 reference voltage chip on the board. As an absolute measuring device it is only good to about $\pm$10\% in absolute temperature. However, most of that error is constant ``gain'' error, so a single temperature calibration should suffice to make this measurement useful. Adjust the nominal temperature limits in the table by the ratio of the actual temperature to the temperature measured assuming the nominal limits.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|l|l|}
\hline
Channel & Function & Low Voltage & High Voltage & Description\\
\hline
00 & OD-A & -51.02 & 51.55 & Output Drains \\
01 & OD-B & -51.02 & 51.55 &\\
02 & OD-C & -51.02 & 51.55& \\
03 & OD-D & -51.02 & 51.55& \\
\hline
04 & RD & -51.02 & 51.55 & Reset Drain\\
\hline
05 & BB & -51.02 & 51.55 & Back Bias \\
\hline
06 & OG &  -12.76 & 12.89& Output Gate \\
\hline
07 & IG1V & -12.76 & 12.89& Charge Input Gate 1\\
\hline
10 & +15 & -51.02 & 51.55 & Power Supplies\\
11 & -15 & -51.02 & 51.55 & \\
12 & -28 & -51.02 & 51.55 &\\
13 & +5 & -12.76 & 12.89&\\
14 & +3.3&  -12.76 & 12.89&\\
15 & +5ADC & -12.76 & 12.89& \\
\hline
16 & DTEMP & -365 K & 369 K & Driver Board Temperature\\
\hline
17 & IG2V &  -12.76 & 12.89& Charge Input Gate 2 \\
\hline
20 & RGHI & -12.76 & 12.89& Reset Gate\\
21 & RGLO & -12.76 & 12.89& \\
\hline
22 & SGHI & -12.76 & 12.89& Summing Gate \\
23 & SGLO & -12.76 & 12.89& \\
\hline
24 & TGHI & -12.76 & 12.89& Transfer Gate\\
25 & TGLO & -12.76 & 12.89& \\
\hline
26 & ISVHI & -51.02 & 51.55 & Charge Input Source\\
27 & ISVLO &-51.02 & 51.55& \\
\hline
30 & PHHI & -12.76 & 12.89& Horizontal Clocks\\
31 & PHLO & -12.76 & 12.89&\\
\hline
32 & VIHI & -12.76 & 12.89& Vertical Image Clocks\\
33 & VILO & -12.76 & 12.89&\\
\hline
34 & VSHI & -12.76 & 12.89& Vertical Storage Clocks\\
35 & VSLO & -12.76 & 12.89&\\
\hline
36 & +2.5ref & -12.76 & 12.89& ADC and DAC Reference Voltage\\
\hline
37 & GND & -12.76 & 12.89& Driver Board Ground Plane\\
\hline
40 & VT & -424 K& 428 K & Video Board Temperature\\
\hline
41 & AR & -12.76 & 12.89& Video Delta-Sigma Modulator Reference\\
\hline
42 & DR &-12.76 & 12.89& Video Bias Compensation Reference\\
\hline
43 & HK-3.3A &-12.76 & 12.89& Analog 3.3V at Sensor Body\\
\hline
44 & HK-3.3D &-12.76 & 12.89& Digital 3.3V at Sensor Body\\
\hline
45 & HK-2.5D &-12.76 & 12.89& Digital 2.5V at Sensor Body\\
\hline
46 & HK-1.5D &-12.76 & 12.89& Digital 1.5V at Sensor Body\\
\hline
47 & TCEHK & -1.3 A& 1.3 A & TCE Heater Current\\
\hline
\end{tabular}
\caption{Housekeeping Channels}
\label{HKC}
\end{table}
\end{document}
